<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./layui/css/layui.css">
    <title>EditSurvey</title>
</head>

<body style="background-color:#F0F0F0;">
    <script id="demo" type="text/html">
        <input class="layui-input" type="text" name="title" placeholder="请输入文字" value="{{ d.title }}" autocomplete="off" style="margin: 0 auto; max-width: 500px; margin-top: 20px; height: 60px; font-size: 200%;">
        <form class="layui-form" action="" style="margin-top: 20px; margin-right: 50px; margin-left: 50px">
        <ul>
            {{#  var count = 1; }}
            {{#  layui.each(d.qlist, function(index, qitem){ }}
            <li>
                <div class="layui-card">
                    <div class="layui-card-header">问题{{ count }}</div>
                    <div class="layui-card-body">
                        <div class="layui-form-item">
                            <label class="layui-form-label">问题类型</label>
                            <div class="layui-input-block">
                              <select lay-filter="qtype" name="qtype_{{ count }}">
                                <option value="0">单选题</option>
                                <option value="1">多选题</option>
                                <option value="2">填空题</option>
                              </select>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">问题内容</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text" name="qcontent_{{ count }}" placeholder="请输入文字" value:{{ qitem.qcontent }} autocomplete="off">
                            </div>
                        </div>
                        <div class="layui-form-item" id="optionbox_{{ count }}">
                            {{#  var optioncount = 1; }}
                            {{#  layui.each(qitem.qoptions, function(index, qoptionitem){ }}
                            <div class="layui-form-item">
                                <div class="layui-inline">
                                    <label class="layui-form-label">选项{{ optioncount }}</label>
                                    <div class="layui-input-inline" style="width: 300px;">
                                        <input class="layui-input" type="text" name="option_{{ count }}_{{ optioncount }}" style="width: 100%;">
                                    </div>
                                </div>
                                <div class="layui-inline">
                                    <label class="layui-form-label">自填</label>
                                    <div class="layui-input-inline" style="width: 100px;">
                                        <input type="checkbox" lay-skin="primary" name="optiontype_{{ count }}_{{ optioncount }}">
                                    </div>
                                </div>
                            </div>
                            {{#  optioncount += 1; }); }}
                        </div>
                    </div>
                </div>
            </li>
            <br>
            <br>
            {{#  count += 1;   }}
            {{#  }); }}
            {{#  if(d.qlist.count === 0){ }}
            无数据
            {{#  } }} 
        </ul>
        </form>
    </script>

    <div id="view"></div>

    <script src="./jquery-3.6.0.min.js"></script>
    <script src="./layui/layui.js"></script>
    <script src="./app.js"></script>
    <script>
        window.onload = function () {
            formdata.author.a_id = window.location.href.getValue('a_id');
            formdata.author.a_nickname = window.location.href.getValue('a_nickname');
            $("#qtype_1").val('1');
        }
        var formdata = { //数据
            "title": "未命名问卷"
            , "author": { "a_id": 12345, "a_nickname": "rssau" }
            , "qlist": [
                {
                    "qcontent": "问题一"
                    , "type": 0
                    , "nullable": 0
                    , "qoptions": [{ "type": 0, "ocontent": "答案1" }, { "type": 0, "ocontent": "答案2" }, { "type": 0, "ocontent": "答案3" }]
                }
            ]

        }
        layui.use('element', function () {
            var element = layui.element;
        });
        layui.use('form', function () {
            var form = layui.form;

            form.on("select(qtype)", function (data) {
                var item = data.elem
                , value = Number(data.value);

                var qid = $(item).attr("name").substr(-1, 1);
                var parent = $(item).parents(".layui-card");
                switch (value) {
                    case 0:
                        formdata.qlist[qid-1].type = value;
                        rerender();
                        break;
                    case 1:
                        formdata.qlist[qid-1].type = value;
                        rerender();
                        break;
                    case 2:
                        formdata.qlist[qid-1].type = value;
                        rerender();
                        break;
                    default:
                        break;
                }
            });
        });
        layui.use('laytpl', function () {
            var laytpl = layui.laytpl;
            var getTpl = demo.innerHTML
                , view = document.getElementById('view');
            laytpl(getTpl).render(formdata, function (html) {
                view.innerHTML = html;
            });
        });

        function rerender () {
            var laytpl = layui.laytpl;
            var getTpl = demo.innerHTML
                , view = document.getElementById('view');
            laytpl(getTpl).render(formdata, function (html) {
                view.innerHTML = html;
            });
            var form = layui.form;
            form.render();
        }
    </script>
</body>

</html>